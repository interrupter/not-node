const
  notNode = require('not-node'),
  Auth = require('not-node').Auth,
  header = require('../libs/headers.js'),
  siteRouter = require('./site');

module.exports = function(web) {

  //можно запросить манифест для клиент-серверного обмена
  web.get('/api/manifest', function(req, res) {
    header.setForFile(res);
    console.log('manifest');
    res.status(200).json(notNode.Application.getManifest(req));
  });
  //

  web.get('/', (req, res, next) => {
      if (Auth.isUser(req)) {
        res.redirect('/dashboard');
      }else{
        next();
      }
    },
    siteRouter.index
  );


  web.get('/dashboard*',
    (req, res, next) => {
      if (Auth.isUser(req)) {
        next();
      } else {
        res.redirect('/login');
      }
    },
    siteRouter.dashboard
  );

};
